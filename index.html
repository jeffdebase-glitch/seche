<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>S√®che ‚Äì Jeff</title>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", Arial, sans-serif;
      background: #f5f5f7;
      color: #111;
    }
    header {
      text-align: center;
      padding: 10px 0;
      font-size: 18px;
      font-weight: 600;
      background: #fff;
      position: sticky;
      top: 0;
      z-index: 10;
      border-bottom: 1px solid #ddd;
    }
    main { padding: 10px; max-width: 600px; margin: auto; }
    #buttons { display: flex; flex-wrap: wrap; justify-content: space-between; }
    .btn {
      width: 48%; padding: 10px; margin: 4px 0;
      border-radius: 10px; border: 1px solid #d0d0d5;
      background: #fff; font-size: 14px; text-align: left;
    }
    .btn span { font-size: 11px; color: #777; display: block; }
    .list-box {
      background: #fff; margin-top: 12px; border-radius: 10px;
      border: 1px solid #ddd; padding: 8px; max-height: 260px; overflow-y: auto;
    }
    .row { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 4px 0; font-size: 13px; }
    .row:last-child { border-bottom: none }
    .row-main { flex: 1; }
    .row-actions { font-size: 11px; text-align: right; }
    .link { color: #007aff; cursor: pointer; display: block; }
    .danger { color: #ff3b30 }
    .total {
      margin-top: 10px; background: #fff; padding: 8px; border-radius: 10px;
      border: 1px solid #ddd; font-size: 15px; font-weight: 600;
    }
    textarea {
      margin-top: 8px; width: 100%; height: 110px;
      border-radius: 10px; border: 1px solid #bbb; padding: 8px;
    }
    #copyBtn {
      margin-top: 8px; padding: 12px; width: 100%;
      background: #007aff; color: #fff; border: none;
      border-radius: 12px; font-size: 15px; font-weight: 600;
    }
    .popup { position: fixed; inset: 0; background: rgba(0,0,0,.35); display:none; align-items:center; justify-content:center }
    .popup.active { display:flex }
    .popup-box { background:#fff; border-radius:14px; padding:14px; width:85%; max-width:320px }
    .popup-btn { padding:6px 12px; margin:3px; border-radius:999px; border:1px solid #ccc; background:#f5f5f7 }
  </style>
</head>
<body>

<header>S√®che ‚Äì Jeff</header>
<main>

<div id="buttons"></div>

<div class="list-box" id="selected"></div>

<div class="total" id="totals">Total net : 0 kcal ‚Äî 0 g prot</div>

<textarea id="output" readonly></textarea>
<button id="copyBtn" onclick="copyText()">üìã Copier pour ChatGPT</button>

</main>

<!-- POPUP GRAMMES -->
<div class="popup" id="gram-popup">
  <div class="popup-box">
    <div id="gram-title"></div>
    <div id="gram-buttons"></div>
    <button onclick="closeGramPopup()">Annuler</button>
  </div>
</div>

<script>
const ITEMS = {
  whey1:{label:"ü•õ Whey 1 cup",k:110,p:20,u:"cup",q:1},
  whey2:{label:"ü•õ Whey 2 cups",k:110,p:20,u:"cup",q:2},

  spoon:{label:"ü•õ Spoon Prot√©in√©",k:115,p:25,u:"pot",q:1},

  chicken:{label:"üçó Poulet",k:1.65,p:0.31,u:"g",popup:[200,250,300,350,400]},
  salad:{label:"ü•ó Salade + l√©gumes",k:0.15,p:0.01,u:"g",popup:[200,250,300,350,400]},
  pasta:{label:"üçù P√¢tes cuites",k:1.5,p:0.035,u:"g",popup:[50,100,120,150,200]},

  psyllium:{label:"üßÇ Psyllium",k:0,p:0,u:"dose",q:1},
  oil:{label:"ü´í Huile d‚Äôolive",k:9,p:0,u:"g",q:10},
};

let selected=[]; let gramKey=null;

function buildButtons() {
  let html="";
  for (const k in ITEMS) {
    html+=`<button class="btn" onclick="addItem('${k}')">${ITEMS[k].label}</button>`;
  }
  document.getElementById("buttons").innerHTML=html;
}

function addItem(key) {
  const it=ITEMS[key];
  if (it.popup) return openGramPopup(key);
  const qty=it.q;
  selected.push({key,qty,kcal:it.k*qty,prot:it.p*qty});
  render();
}

function openGramPopup(key) {
  gramKey=key;
  const it=ITEMS[key];
  document.getElementById("gram-title").textContent=it.label;
  const box=document.getElementById("gram-buttons"); box.innerHTML="";
  it.popup.forEach(v=>{
    const b=document.createElement("button");
    b.className="popup-btn"; b.textContent=v+" g";
    b.onclick=()=>selectGram(v); box.appendChild(b);
  });
  document.getElementById("gram-popup").classList.add("active");
}

function closeGramPopup(){ document.getElementById("gram-popup").classList.remove("active"); }

function selectGram(v){
  const it=ITEMS[gramKey];
  selected.push({key:gramKey,qty:v,kcal:it.k*v,prot:it.p*v});
  closeGramPopup(); render();
}

function render(){
  let html="",totK=0,totP=0,copy=[];
  selected.forEach((it,i)=>{
    const def=ITEMS[it.key];
    html+=`<div class="row"><div>${def.label} ${it.qty}${def.u} (${Math.round(it.kcal)} kcal, ${Math.round(it.prot)} g prot)</div>
    <div class="row-actions"><span class="link" onclick="removeItem(${i})">Suppr</span></div></div>`;
    totK+=it.kcal; totP+=it.prot;
    copy.push(`${def.label} ${it.qty}${def.u} (${Math.round(it.kcal)} kcal, ${Math.round(it.prot)} g prot)`);
  });
  document.getElementById("selected").innerHTML=html;
  document.getElementById("totals").textContent=
    `Total net : ${Math.round(totK)} kcal ‚Äî ${Math.round(totP)} g prot`;
  document.getElementById("output").value = copy.join("\n");
}

function removeItem(i){ selected.splice(i,1); render(); }

function copyText(){
  const t=document.getElementById("output");
  t.select(); document.execCommand("copy");
  alert("Copi√© !");
}

buildButtons(); render();
</script>
</body>
</html>
